/*
 * {{ soc_name }}_bindings.cpp
 * Generated by PeakRDL-pybind11
 * 
 * PyBind11 bindings for SystemRDL register map (main module)
 */

#include <pybind11/pybind11.h>
#include <pybind11/functional.h>
#include "{{ soc_name }}_descriptors.hpp"

namespace py = pybind11;
using namespace {{ soc_name }};

// Forward declarations for chunk binding functions
{% for i in range(num_chunks) %}
void bind_registers_chunk_{{ i }}(py::module& m);
{% endfor %}

PYBIND11_MODULE(_{{ soc_name }}_native, m) {
    m.doc() = "{{ soc_name }} register map generated from SystemRDL";
    
    // Master interface
    py::class_<Master>(m, "Master")
        .def("read", &Master::read, "Read from address")
        .def("write", &Master::write, "Write to address");
    
    // FieldBase
    py::class_<FieldBase>(m, "FieldBase")
        .def_property_readonly("name", &FieldBase::name)
        .def_property_readonly("offset", &FieldBase::offset)
        .def_property_readonly("lsb", &FieldBase::lsb)
        .def_property_readonly("msb", &FieldBase::msb)
        .def_property_readonly("width", &FieldBase::width)
        .def_property_readonly("is_readable", &FieldBase::is_readable)
        .def_property_readonly("is_writable", &FieldBase::is_writable)
        .def_property_readonly("mask", &FieldBase::mask);
    
    // RegisterBase
    py::class_<RegisterBase>(m, "RegisterBase")
        .def_property_readonly("name", &RegisterBase::name)
        .def_property_readonly("offset", &RegisterBase::offset)
        .def_property_readonly("width", &RegisterBase::width)
        .def("read", &RegisterBase::read, "Read register value")
        .def("write", &RegisterBase::write, "Write register value")
        .def("modify", &RegisterBase::modify, "Read-modify-write operation");
    
    // NodeBase
    py::class_<NodeBase>(m, "NodeBase")
        .def_property_readonly("name", &NodeBase::name)
        .def_property_readonly("offset", &NodeBase::offset);
    
    // Bind register chunks (compiled in separate files for parallel compilation)
    {% for i in range(num_chunks) %}
    bind_registers_chunk_{{ i }}(m);
    {% endfor %}
    
    // Top-level SoC class
    py::class_<{{ soc_name }}_t, NodeBase>(m, "{{ soc_name }}_t")
        .def(py::init<>())
        .def("attach_master", &{{ soc_name }}_t::attach_master, "Attach a master interface")
        {% for child in top_node.children() %}
        {% if child.inst_name %}
        .def_readonly("{{ child.inst_name }}", &{{ soc_name }}_t::{{ child.inst_name }})
        {% endif %}
        {% endfor %}
        ;
}
